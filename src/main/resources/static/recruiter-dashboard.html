<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹›è˜ä¸“å‘˜ä¸­å¿ƒ - æ‹›è˜ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/components/card.css">
    <link rel="stylesheet" href="css/components/table.css">
    <style>
        /* æ‹›è˜ä¸“å‘˜ç‰¹æœ‰æ ·å¼ */
        .recruiter-role-badge {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }

        .dual-function-card {
            background: linear-gradient(135deg, #f6f7f9 0%, #e9ecef 100%);
            border-left: 4px solid #667eea;
        }
    </style>
</head>
<body>
<!-- å¯¼èˆªæ  -->
<nav class="navbar">
    <div class="container nav-content">
        <div class="nav-logo">
            <a href="index.html" class="btn btn-sm" style="margin-right: 15px;">è¿”å›é¦–é¡µ</a>
            <h1>æ‹›è˜ç³»ç»Ÿ - æ‹›è˜ä¸“å‘˜ <span class="recruiter-role-badge">HR\+é¢è¯•å®˜</span></h1>
        </div>
        <div class="nav-user">
            <span id="user-greeting">æ¬¢è¿ï¼Œæ‹›è˜ä¸“å‘˜</span>
            <button class="btn logout-btn" onclick="handleLogout()">é€€å‡º</button>
        </div>
    </div>
</nav>

<div class="container">
    <!-- åŠŸèƒ½æ¦‚è§ˆå¡ç‰‡ -->
    <div class="card dual-function-card">
        <h3 style="margin-bottom: 10px;">ğŸ‘¥ åŒé‡èŒè´£ï¼šHR \+ é¢è¯•å®˜</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <strong>HRåŠŸèƒ½ï¼š</strong>
                <ul style="margin: 8px 0 0 20px; font-size: 13px; color: #666;">
                    <li>ç®¡ç†äººæ‰åº“</li>
                    <li>ç­›é€‰å’Œå‚¨å¤‡äººæ‰</li>
                    <li>å®‰æ’é¢è¯•æµç¨‹</li>
                    <li>è·Ÿè¸ªæ‹›è˜è¿›åº¦</li>
                </ul>
            </div>
            <div>
                <strong>é¢è¯•å®˜åŠŸèƒ½ï¼š</strong>
                <ul style="margin: 8px 0 0 20px; font-size: 13px; color: #666;">
                    <li>è¿›è¡Œé¢è¯•è¯„ä»·</li>
                    <li>è®°å½•é¢è¯•åé¦ˆ</li>
                    <li>æäº¤å½•ç”¨å»ºè®®</li>
                    <li>ç®¡ç†é¢è¯•æ—¥ç¨‹</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- æ ‡ç­¾é¡µ -->
    <div class="dashboard-tabs">
        <button class="tab-btn active" onclick="switchTab('schedule')">é¢è¯•æ—¥ç¨‹</button>
        <button class="tab-btn" onclick="switchTab('candidates')">å€™é€‰äººç®¡ç†</button>
        <button class="tab-btn" onclick="switchTab('talent')">äººæ‰åº“ç®¡ç†</button>
        <button class="tab-btn" onclick="switchTab('evaluation')">é¢è¯•è¯„ä»·</button>
        <button class="tab-btn" onclick="switchTab('reports')">æ‹›è˜æŠ¥è¡¨</button>
    </div>

    <!-- é¢è¯•æ—¥ç¨‹æ ‡ç­¾é¡µï¼ˆç¤ºä¾‹å ä½ï¼‰ -->
    <div id="schedule-tab" class="tab-content active">
        <h2>ä»Šæ—¥é¢è¯•æ—¥ç¨‹</h2>
        <div class="card">
            <p>è¿™é‡Œå±•ç¤ºä»Šæ—¥å’Œæœªæ¥å‡ å¤©çš„é¢è¯•å®‰æ’ï¼ˆç¤ºä¾‹å ä½ï¼‰ã€‚</p>
        </div>
    </div>

    <!-- å€™é€‰äººç®¡ç†æ ‡ç­¾é¡µï¼ˆç¤ºä¾‹å ä½ï¼‰ -->
    <div id="candidates-tab" class="tab-content">
        <h2>å€™é€‰äººç®¡ç†</h2>
        <div class="card">
            <p>è¿™é‡Œå±•ç¤ºå€™é€‰äººåˆ—è¡¨ã€çŠ¶æ€å’Œæ“ä½œå…¥å£ï¼ˆç¤ºä¾‹å ä½ï¼‰ã€‚</p>
        </div>
    </div>

    <!-- äººæ‰åº“ç®¡ç†æ ‡ç­¾é¡µ -->
    <div id="talent-tab" class="tab-content">
        <div class="flex items-center justify-between mb-4">
            <h2>ä¼ä¸šäººæ‰åº“</h2>
            <div class="flex gap-2">
                <select id="talent-filter" onchange="filterTalent()">
                    <option value="">å…¨éƒ¨äººæ‰</option>
                    <option value="web">Webå¼€å‘</option>
                    <option value="java">Javaå¼€å‘</option>
                    <option value="ui">UIè®¾è®¡</option>
                </select>
                <input type="text" placeholder="æœç´¢äººæ‰..." oninput="searchTalent()">
                <button class="btn btn-primary" onclick="addNewTalent()">\+ æ·»åŠ äººæ‰</button>
            </div>
        </div>

        <div class="talent-stats mb-4">
            <div class="card" style="padding: 15px;">
                <div class="flex justify-between">
                    <div>
                        <strong>äººæ‰åº“ç»Ÿè®¡</strong>
                        <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">
                            å…± <span id="total-talents">0</span> äºº |
                            æ´»è·ƒäººæ‰ï¼š<span id="active-talents">0</span> äºº |
                            æœ€è¿‘è¢«é‚€è¯·ï¼š<span id="recent-invited">0</span> äºº
                        </p>
                    </div>
                    <button class="btn btn-sm" onclick="exportTalentData()">å¯¼å‡ºæ•°æ®</button>
                </div>
            </div>
        </div>

        <div class="talent-list" id="recruiter-talent-list">
            <div class="empty-state">
                <div class="icon">ğŸ“š</div>
                <p>æ­£åœ¨åŠ è½½äººæ‰åº“...</p>
            </div>
        </div>
    </div>

    <!-- é¢è¯•è¯„ä»·æ ‡ç­¾é¡µï¼ˆç¤ºä¾‹å ä½ï¼‰ -->
    <div id="evaluation-tab" class="tab-content">
        <h2>é¢è¯•è¯„ä»·</h2>
        <div class="card">
            <p>è¿™é‡Œå±•ç¤ºé¢è¯•è¯„ä»·åˆ—è¡¨åŠå½•å…¥å…¥å£ï¼ˆç¤ºä¾‹å ä½ï¼‰ã€‚</p>
        </div>
    </div>

    <!-- æ‹›è˜æŠ¥è¡¨æ ‡ç­¾é¡µ -->
    <div id="reports-tab" class="tab-content">
        <h2>æ‹›è˜æ•°æ®æŠ¥è¡¨</h2>
        <div class="card">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h4>æœ¬æœˆæ‹›è˜æ•°æ®</h4>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>æ–°å¼€å¯èŒä½ï¼š</span>
                            <strong>24</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>æ”¶åˆ°ç®€å†ï¼š</span>
                            <strong>320</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>å®‰æ’é¢è¯•ï¼š</span>
                            <strong>96</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>å‘å‡ºOfferï¼š</span>
                            <strong style="color: var(--success-color);">18</strong>
                        </div>
                    </div>
                </div>

                <div>
                    <h4>äººæ‰åº“ä»·å€¼</h4>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>äººæ‰åº“æ€»äººæ•°ï¼š</span>
                            <strong>150</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>è¿‘æœŸæœ‰è”ç³»ï¼š</span>
                            <strong>45</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>è½¬åŒ–ä¸ºé¢è¯•ï¼š</span>
                            <strong>30</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>è½¬åŒ–ä¸ºå½•ç”¨ï¼š</span>
                            <strong style="color: var(--success-color);">10</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- äººæ‰è¯¦æƒ…æ¨¡æ€æ¡†å®¹å™¨ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ -->
<div id="talent-modal" class="talent-modal" style="display: none;">
    <div class="talent-modal-content">
        <!-- è¿è¡Œæ—¶æ³¨å…¥å†…å®¹ -->
    </div>
</div>

<script src="js/auth.js"></script>
<script src="js/recruitment-api.js"></script> <!-- å¼•å…¥æ–°çš„ recruitment-api.js -->
<script>
    // æ ‡ç­¾é¡µåˆ‡æ¢
    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById(tabName + '-tab').classList.add('active');
        event.target.classList.add('active');

        if (tabName === 'talent') {
            loadTalentPool();
        }
    }

    // åŠ è½½äººæ‰åº“æ•°æ®
    async function loadTalentPool() {
        const talentList = document.getElementById('recruiter-talent-list');
        if (!talentList) return;

        talentList.innerHTML = `<div class="empty-state"><div class="icon">ğŸ”„</div><p>æ­£åœ¨åŠ è½½äººæ‰æ•°æ®...</p></div>`;

        try {
            const talents = await ApiService.getTalentPool();

            if (!talents || talents.length === 0) {
                talentList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“š</div>
                        <p>äººæ‰åº“ä¸ºç©º</p>
                        <p style="font-size: 12px; margin-top: 8px;">ç‚¹å‡»"æ·»åŠ äººæ‰"æŒ‰é’®å¼€å§‹å»ºç«‹äººæ‰åº“</p>
                    </div>
                `;
                updateTalentStats([]);
                return;
            }

            updateTalentStats(talents);

            talentList.innerHTML = talents.map(talent => `
                <div class="talent-card">
                    <div class="talent-header">
                        <div>
                            <h3 class="talent-name">${talent.name}</h3>
                            <div style="font-size: 14px; color: #666; margin-top: 4px;">
                                ${talent.position || 'æœªå¡«å†™èŒä½'} Â· ${talent.experience || 'ç»éªŒä¸è¯¦'} Â· ${talent.education || 'å­¦å†ä¸è¯¦'}
                            </div>
                        </div>
                        <span class="talent-source">${talent.source || 'æœªçŸ¥'}</span>
                    </div>

                    <div class="talent-info">
                        <div class="talent-info-item">
                            <span>ğŸ“±</span>
                            <span>${talent.phone || 'æœªæä¾›'}</span>
                        </div>
                        <div class="talent-info-item">
                            <span>ğŸ“§</span>
                            <span>${talent.email || 'æœªæä¾›'}</span>
                        </div>
                        <div class="talent-info-item">
                            <span>ğŸ“…</span>
                            <span>æ·»åŠ ï¼š${talent.createTime ? new Date(talent.createTime).toLocaleDateString() : 'æœªçŸ¥'}</span>
                        </div>
                    </div>

                    <div class="talent-tags">
                        ${(talent.skills || []).slice(0, 5).map(skill =>
                `<span class="talent-tag">${skill}</span>`
            ).join('')}
                    </div>

                    ${talent.note ? `
                    <div class="talent-note">
                        <strong>å¤‡æ³¨ï¼š</strong>
                        ${talent.note}
                    </div>
                    ` : ''}

                    <div class="talent-actions">
                        <button class="btn btn-sm" onclick="viewTalent(${talent.id})">æŸ¥çœ‹</button>
                        <button class="btn btn-primary btn-sm" onclick="inviteTalent(${talent.id})">é‚€è¯·é¢è¯•</button>
                        <button class="btn btn-sm" onclick="editTalent(${talent.id})">ç¼–è¾‘</button>
                        <button class="btn btn-danger btn-sm" onclick="removeTalent(${talent.id})">ç§»é™¤</button>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            talentList.innerHTML = `<div class="empty-state"><div class="icon">âŒ</div><p>åŠ è½½äººæ‰æ•°æ®å¤±è´¥</p><p style="font-size:12px;color:var(--danger-color);">${error.message}</p></div>`;
        }
    }

    // æ›´æ–°äººæ‰åº“ç»Ÿè®¡
    function updateTalentStats(talents = []) {
        const activeTalents = talents.filter(t => t.status === 'active').length; // å‡è®¾åç«¯æœ‰statuså­—æ®µ

        document.getElementById('total-talents').textContent = talents.length;
        document.getElementById('active-talents').textContent = activeTalents || talents.length; // å¦‚æœæ²¡æœ‰statusï¼Œåˆ™å…¨éƒ¨è§†ä¸ºæ´»è·ƒ
        document.getElementById('recent-invited').textContent = Math.floor(talents.length * 0.3); // æ¨¡æ‹Ÿæ•°æ®
    }

    // ç®€å•æŸ¥çœ‹ï¼ˆæç¤ºç‰ˆï¼‰
    function inviteTalent(talentId) {
        const jobTitle = prompt('è¯·è¾“å…¥è¦é‚€è¯·çš„èŒä½ï¼š', 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ');
        if (jobTitle) {
            alert('å·²å‘äººæ‰ ' + talentId + ' å‘é€ ' + jobTitle + ' çš„é¢è¯•é‚€è¯·ï¼ˆæ¨¡æ‹Ÿæ“ä½œï¼‰');
        }
    }

    async function editTalent(talentId) {
        const newNote = prompt('è¯·è¾“å…¥æ–°çš„å¤‡æ³¨ä¿¡æ¯ï¼š');
        if (newNote === null) return; // ç”¨æˆ·å–æ¶ˆ

        try {
            const talent = await ApiService.getTalentById(talentId);
            talent.note = newNote;
            await ApiService.updateTalent(talent);
            alert('äººæ‰ ' + talentId + ' çš„ä¿¡æ¯å·²æ›´æ–°');
            loadTalentPool();
        } catch (error) {
            // é”™è¯¯ä¿¡æ¯å·²åœ¨ ApiService ä¸­ alert
        }
    }

    async function removeTalent(talentId) {
        if (confirm('ç¡®å®šè¦ä»äººæ‰åº“ç§»é™¤è¯¥äººæ‰å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
            try {
                await ApiService.removeTalent(talentId);
                alert('äººæ‰ ' + talentId + ' å·²ä»äººæ‰åº“ç§»é™¤');
                loadTalentPool();
            } catch (error) {
                // é”™è¯¯ä¿¡æ¯å·²åœ¨ ApiService ä¸­ alert
            }
        }
    }

    // æ·»åŠ æ–°äººæ‰
    async function addNewTalent() {
        const name = prompt('è¯·è¾“å…¥äººæ‰å§“åï¼š');
        if (!name) return;
        const position = prompt('è¯·è¾“å…¥èŒä½ï¼š');
        if (!position) return;
        const phone = prompt('è¯·è¾“å…¥æ‰‹æœºå·ï¼š');
        const email = prompt('è¯·è¾“å…¥é‚®ç®±ï¼š');

        const newTalent = {
            name,
            position,
            phone,
            email,
            note: 'HRä¸»åŠ¨æ·»åŠ çš„äººæ‰'
        };

        try {
            await ApiService.addTalent(newTalent);
            alert('äººæ‰ "' + name + '" å·²æˆåŠŸæ·»åŠ åˆ°äººæ‰åº“');
            loadTalentPool();
        } catch (error) {
            // é”™è¯¯ä¿¡æ¯å·²åœ¨ ApiService ä¸­ alert
        }
    }

    // ç­›é€‰ä¸æœç´¢ï¼ˆæ¨¡æ‹Ÿï¼‰
    function filterTalent() {
        const v = document.getElementById('talent-filter').value;
        alert('ç­›é€‰äººæ‰ï¼š' + (v || 'å…¨éƒ¨') + 'ï¼ˆæ­¤åŠŸèƒ½ä¸ºå‰ç«¯æ¨¡æ‹Ÿï¼Œå°šæœªå¯¹æ¥åç«¯ï¼‰');
    }

    function searchTalent() {
        const kw = document.querySelector('input[placeholder*="æœç´¢äººæ‰"]').value;
        if (kw) {
            alert('æœç´¢äººæ‰ï¼š' + kw + 'ï¼ˆæ­¤åŠŸèƒ½ä¸ºå‰ç«¯æ¨¡æ‹Ÿï¼Œå°šæœªå¯¹æ¥åç«¯ï¼‰');
        }
    }

    // è¯¦ç»†æŸ¥çœ‹ï¼šæ¨¡æ€æ¡†ç‰ˆ
    async function viewTalent(talentId) {
        try {
            const talent = await ApiService.getTalentById(talentId);
            if (!talent) {
                alert('æ‰¾ä¸åˆ°è¯¥äººæ‰ä¿¡æ¯');
                return;
            }

            const modalHTML = `
                <div class="talent-modal" id="talent-detail-modal" style="display: flex;">
                    <div class="talent-modal-content">
                        <div class="talent-modal-header">
                            <h3 class="talent-modal-title">äººæ‰è¯¦ç»†ä¿¡æ¯</h3>
                            <button class="close-modal" onclick="closeTalentModal()">Ã—</button>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: var(--text-primary);">
                                ${talent.name} - ${talent.position}
                            </h4>
                            <div style="color: var(--text-secondary); font-size: 14px;">
                                ${talent.experience || 'ç»éªŒä¸è¯¦'} Â· ${talent.education || 'å­¦å†ä¸è¯¦'}
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <strong>åŸºæœ¬ä¿¡æ¯</strong>
                                <div style="margin-top: 10px; font-size: 14px;">
                                    <p>ğŸ“± ${talent.phone || 'æœªæä¾›'}</p>
                                    <p>ğŸ“§ ${talent.email || 'æœªæä¾›'}</p>
                                    <p>æ¥æºï¼š${talent.source || 'æœªçŸ¥'}</p>
                                    <p>æ·»åŠ æ—¶é—´ï¼š${talent.createTime ? new Date(talent.createTime).toLocaleString() : 'æœªçŸ¥'}</p>
                                </div>
                            </div>

                            <div>
                                <strong>æŠ€èƒ½æ ‡ç­¾</strong>
                                <div class="talent-tags" style="margin-top: 10px;">
                                    ${(talent.skills || []).map(skill =>
                `<span class="talent-tag">${skill}</span>`
            ).join('')}
                                </div>
                            </div>
                        </div>

                        ${talent.note ? `
                        <div style="margin-bottom: 20px;">
                            <strong>HRå¤‡æ³¨</strong>
                            <div style="margin-top: 10px; padding: 12px; background: #f5f5f5; border-radius: 6px;">
                                ${talent.note}
                            </div>
                        </div>
                        ` : ''}

                        <div style="border-top: 1px solid #eee; padding-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button class="btn" onclick="closeTalentModal()">å…³é—­</button>
                            <button class="btn btn-primary" onclick="inviteTalentFromModal(${talent.id})">é‚€è¯·é¢è¯•</button>
                            <button class="btn" onclick="editTalentFromModal(${talent.id})">ç¼–è¾‘ä¿¡æ¯</button>
                        </div>
                    </div>
                </div>
            `;

            const container = document.createElement('div');
            container.innerHTML = modalHTML;
            document.body.appendChild(container);
        } catch (error) {
            // é”™è¯¯ä¿¡æ¯å·²åœ¨ ApiService ä¸­ alert
        }
    }

    function inviteTalentFromModal(talentId) {
        closeTalentModal();
        const jobTitle = prompt('è¯·è¾“å…¥è¦é‚€è¯·é¢è¯•çš„èŒä½ï¼š', 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ');
        const interviewTime = prompt('è¯·è¾“å…¥å»ºè®®çš„é¢è¯•æ—¶é—´ï¼ˆYYYY-MM-DD HH:MMï¼‰ï¼š', '2024-01-25 14:00');
        if (jobTitle && interviewTime) {
            alert('å·²å‘äººæ‰ ' + talentId + ' å‘é€é¢è¯•é‚€è¯·\\nèŒä½ï¼š' + jobTitle + '\\næ—¶é—´ï¼š' + interviewTime + 'ï¼ˆæ¨¡æ‹Ÿæ“ä½œï¼‰');
        }
    }

    async function editTalentFromModal(talentId) {
        closeTalentModal();
        const newNote = prompt('è¯·è¾“å…¥æ–°çš„å¤‡æ³¨ä¿¡æ¯ï¼š', 'æŠ€æœ¯èƒ½åŠ›ä¼˜ç§€ï¼Œä¿æŒè”ç³»');
        if (newNote) {
            try {
                const talent = await ApiService.getTalentById(talentId);
                talent.note = newNote;
                await ApiService.updateTalent(talent);
                alert('äººæ‰ä¿¡æ¯å·²æ›´æ–°');
                if (document.getElementById('talent-tab').classList.contains('active')) {
                    loadTalentPool();
                }
            } catch (error) {
                // é”™è¯¯ä¿¡æ¯å·²åœ¨ ApiService ä¸­ alert
            }
        }
    }

    function closeTalentModal() {
        const modal = document.getElementById('talent-detail-modal');
        if (modal) {
            modal.parentElement.remove();
        }
    }

    // é¡µé¢åˆå§‹åŒ–ï¼šæ£€æŸ¥ç™»å½•å¹¶å¡«å……æ¬¢è¿è¯­
    document.addEventListener('DOMContentLoaded', function () {
        const currentUser = Auth.getCurrentUser();
        if (!currentUser) {
            window.location.href = 'login.html';
            return;
        }

        const greeting = document.getElementById('user-greeting');
        if (greeting) {
            greeting.textContent =
                'æ¬¢è¿ï¼Œ' + (currentUser.realName || currentUser.username || 'æ‹›è˜ä¸“å‘˜');
        }

        // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µçš„å†…å®¹ï¼Œå¦‚æœæ˜¯äººæ‰åº“åˆ™åŠ è½½æ•°æ®
        if (document.querySelector('.tab-btn.active').getAttribute('onclick').includes('talent')) {
            loadTalentPool();
        }
    });

    function handleLogout() {
        Auth.logout();
        localStorage.removeItem('returnTo');
        window.location.href = 'index.html';
    }
</script>
</body>
</html>