<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ats.repository.SysNoticeRepository">

    <!-- 根据用户ID查询通知列表 -->
    <select id="selectByUserId" resultType="com.platform.ats.entity.notification.SysNotice">
        SELECT * FROM sys_notice
        WHERE user_id = #{userId}
          AND delete_flag = 0
        ORDER BY send_time DESC
    </select>

    <!-- 根据用户ID和阅读状态查询通知列表 -->
    <select id="selectByUserIdAndReadStatus" resultType="com.platform.ats.entity.notification.SysNotice">
        SELECT * FROM sys_notice
        WHERE user_id = #{userId}
          AND read_status = #{readStatus}
          AND delete_flag = 0
        ORDER BY send_time DESC
    </select>

    <!-- 根据用户ID分页查询通知列表 -->
    <select id="selectPageByUserId" resultType="com.platform.ats.entity.notification.SysNotice">
        SELECT * FROM sys_notice
        WHERE user_id = #{userId}
          AND delete_flag = 0
        ORDER BY send_time DESC
    </select>

    <!-- 根据用户ID和通知类型查询通知列表 -->
    <select id="selectByUserIdAndType" resultType="com.platform.ats.entity.notification.SysNotice">
        SELECT * FROM sys_notice
        WHERE user_id = #{userId}
          AND notice_type = #{noticeType}
          AND delete_flag = 0
        ORDER BY send_time DESC
    </select>

    <!-- 批量更新通知为已读状态 -->
    <update id="batchUpdateReadStatus">
        UPDATE sys_notice
        SET read_status = #{readStatus}
        WHERE notice_id IN
        <foreach collection="noticeIds" item="noticeId" open="(" separator="," close=")">
            #{noticeId}
        </foreach>
    </update>

    <!-- 逻辑删除通知 -->
    <update id="logicDelete">
        UPDATE sys_notice
        SET delete_flag = 1
        WHERE notice_id = #{noticeId}
    </update>

</mapper>